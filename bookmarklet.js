javascript:(()=>{
(function(){"use strict";if("github.com"!==document.location.host)return alert("This script must be run whilst on github.com");if(window.harvest||window.silo)return;const e="";const t="&s=indexed&o=desc";const n="&s=indexed&o=asc";window.silo={};window.harvest=i;Object.defineProperty(window.silo,"reap",{value:f,writable:false,configurable:false});let s=null;Object.defineProperty(window,"that",{get:()=>s?f(s):""});let o=false;window.addEventListener("beforeunload",e=>o?e.returnValue="Your harvest hasn't finished. Are you sure you wish to cancel?":undefined);Notification.requestPermission();function i(i,c=null){o=true;if(!/^extension:|filename:/.test(i))i="extension:"+i;return new Promise(a=>{if(!c){const e=Math.random(1e6).toString(16).replace(/\./,"").toUpperCase();c="NOT nothack"+e}const l=encodeURIComponent(`${i} ${c}`).replace(/%20/g,"+");const u=`https://github.com/search?q=${l}&type=Code`;return r(u,e,i).then(e=>{return e>1e3?r(u,t,i).then(()=>r(u,n,i)).then(()=>a()):a()}).then(()=>{const e="Run `copy(that);` in your console to copy the URLs to your clipboard.";new Notification(`Harvest complete for ${i}`,{body:e});s=i;o=false})}).catch(e=>{o=false;throw e})}function r(e,t,n){const s=silo[n]||(silo[n]={length:0});return new Promise((n,o)=>{let i=0;let r;let l;f().then(()=>Promise.resolve(l));function f(){return u(e+t+(i?"&p="+(i+1):"")).catch(e=>o(e)).then(e=>e.text().then(e=>{if(/<div[^>]+class="blankslate">/.test(e)){const t="Must include at least one user, organization, or repository";const n=t.split(" ").join("\\s+");const s=new RegExp(n,"i").test(e)?["Failed.","GitHub's doing that weird thing again:",`\t> "${t}"`].join("\n\n"):"No results";return o(s)}a(e,s);if(undefined===r){const t=e.match(/">(\d+)<\/a>\s*<a[^>]+?class="next_page"[^>]+?rel="next"/i);if(t){l=+e.match(/<h3>\s*(?:We.ve\s+found\s+)?([,\d]+)\s+code\s+results/i)[1].replace(/\D/g,"");r=t[1]}else{l=s.length;r=1}}++i;if(i>=r)return n(l);return c(2e3).then(()=>f())}))}})}function c(e){return new Promise(t=>setTimeout(()=>t(),e))}function a(e,t){const n=e.match(/<div[^>]+id="code_search_results"[^>]*>/i);const s=e.match(/<div[^>]+id="search_cheatsheet_pane"/i);e=e.substring(n.index,s.index);const o=e.split(/<div[^>]+class="[^"]*code-list-item[^"]+code-list-item-public[^"]*"[^>]*>/gi);for(const e of o){const n=l(e);const s=n.find(e=>/^@[^@]/.test(e.alt)&&-1!==e.classList.indexOf("avatar"));if(!s)continue;const o=e.match(/^(?:.|\n)*?(?:&#8211;|â€“)\s*<a[^>]+href="([^"]+)"/i)[1];if(!t[o]){t[o]=o.replace(/^((?:\/[^/]+){2})\/blob(?=\/)/gim,"https://raw.githubusercontent.com$1");++t.length}}}function l(e){const t=[];const n=e.match(/<img[^>]*>/gi);if(!n)return t;for(const e of n){const n=Object.create(null);const s=e.replace(/^<img\s*|\s*\/?>$/g,"").match(/([^=]+)\s*=\s*("[^"]*"|'[^']*'|[^'"\s]+)/g).map(e=>{const[t,n]=e.match(/^\s*([^\s=]+)=(.*)$/).slice(1);return[t.toLowerCase(),n.replace(/^(["'])(.*)\1$/,"$2")]});for(let[e,t]of s)switch(e){case"width":case"height":n[e]=parseInt(t);break;case"class":n.className=t;n.classList=t.trim().split(/\s+/);break;default:n[e]=t}t.push(n)}return t}function u(e){return new Promise((t,n)=>{const s=new XMLHttpRequest;s.open("GET",e);s.addEventListener("readystatechange",()=>{if(XMLHttpRequest.DONE===s.readyState)t({text:()=>Promise.resolve(s.response)})});for(const e of"abort error timeout".split(" "))s.addEventListener(e,e=>n(e));s.send()})}function f(e){if(!/^extension:|filename:/.test(e)){const t="extension:"+e in silo;const n="filename:"+e in silo;if(t&&n){const t=`Both extension:${e} and filename:${e} properties exist in silo.`;throw new ReferenceError(t+" Which did you mean?")}if(t)e="extension:"+e;else if(n)e="filename:"+e}const t=silo[e]||{};return Object.keys(t).filter(e=>e!=="length").map(e=>t[e]).sort((e,t)=>{e=e.toLowerCase();t=t.toLowerCase();if(e<t)return-1;if(e>t)return 1;return 0}).join("\n")}})();
let q=prompt("Enter an extension or filename to harvest:");q&&harvest(q)})();